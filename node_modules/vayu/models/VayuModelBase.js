var mongoose = require('mongoose');
var util = require('util');

var _schema = null;

var _saveErr = function (err)
{
    console.log(err);
}

var _saveSuccess = function (model)
{
    console.log("saved " + model.id);
}

function VayuModelBase()
{

}

var p = VayuModelBase.prototype;

p.Model = null;

p.Schema = mongoose.Schema;

p.initSchema = function (obj)
{
    _schema = new this.Schema(obj);

    _schema.pre('save', function (next)
    {
        this.ud = new Date();
        next();
    });
}

p.initModel = function(name, schemaName)
{
    this.Model = mongoose.model(name, _schema, schemaName);
}

p.init = function (name, schemaName, schema)
{
    schema.ud = { "type": Date, "default": Date.now };
    this.initSchema(schema);
    this.initModel(name, schemaName);
}

p.saveModel = function (model, success, fail)
{
    model.save(function (err)
    {
        if (err)
        {
            _saveErr(err);
            fail(err, model);
        } else
        {
            _saveSuccess(model);
            success(model);
        }
    });
}

p.findByID = function(id, success, fail)
{
    this.Model.findOne({ _id: id}, function (err, doc)
    {
        if (err)
        {
            fail(err)
        } else
        {
            success(doc);
        }
    });
}

p.find = function(cond, fields, options, success, fail)
{
    this.Model.find(cond, fields, options, function (err, doc)
    {
        if (err)
        {
            fail(err);
        } else
        {
            success(doc);
        }
    })
}

module.exports = exports = VayuModelBase;